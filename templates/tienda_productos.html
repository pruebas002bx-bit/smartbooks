<section class="relative bg-[#143c6c] py-20 text-center animate-scroll-reveal">
    <div class="relative z-10 px-4">
        <span class="inline-block py-1 px-4 rounded-full bg-white/10 text-white text-xs font-bold uppercase tracking-widest mb-4 border border-white/20 backdrop-blur-md">Catálogo Oficial</span>
        <h1 class="font-outfit text-4xl md:text-5xl font-black text-white mb-2">Tienda Escolar</h1>
        <p class="text-blue-100 font-instrument text-lg">Textos, literatura y recursos para todos los niveles.</p>
    </div>
</section>

<section class="py-16 bg-gray-50 min-h-screen">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="flex flex-col lg:flex-row gap-10">
            
            <aside class="lg:w-1/4">
                <div class="bg-white p-6 rounded-2xl shadow-lg border border-gray-100 sticky top-24">
                    <div class="flex justify-between items-center mb-6 pb-4 border-b border-gray-100">
                        <h3 class="font-bold text-gray-800 font-outfit uppercase tracking-wide text-sm flex items-center"><i class="fas fa-filter mr-2 text-[#143c6c]"></i> Filtros</h3>
                        <button onclick="resetFilters()" class="text-xs text-[#143c6c] font-bold hover:underline">Limpiar</button>
                    </div>
                    <div class="mb-8">
                        <label class="text-xs font-bold text-gray-400 uppercase mb-2 block">Búsqueda</label>
                        <div class="relative">
                            <i class="fas fa-search absolute left-3 top-3 text-gray-400 text-sm"></i>
                            <input type="text" id="store-search" placeholder="Título, autor..." class="w-full pl-9 p-3 border border-gray-200 rounded-xl text-sm focus:outline-none focus:border-[#143c6c] bg-gray-50">
                        </div>
                    </div>
                    <div>
                        <label class="text-xs font-bold text-gray-400 uppercase mb-3 block">Editoriales</label>
                        <div class="space-y-3">
                            <label class="flex items-center cursor-pointer group"><input type="checkbox" class="filter-cb w-4 h-4 text-[#143c6c]" value="Macmillan"> <span class="ml-3 text-sm text-gray-600 font-instrument">Macmillan Education</span></label>
                            <label class="flex items-center cursor-pointer group"><input type="checkbox" class="filter-cb w-4 h-4 text-[#143c6c]" value="Castillo"> <span class="ml-3 text-sm text-gray-600 font-instrument">Ediciones Castillo</span></label>
                            <label class="flex items-center cursor-pointer group"><input type="checkbox" class="filter-cb w-4 h-4 text-[#143c6c]" value="Scholastic"> <span class="ml-3 text-sm text-gray-600 font-instrument">Scholastic</span></label>
                        </div>
                    </div>
                </div>
            </aside>

            <div class="lg:w-3/4">
                <div class="flex justify-between items-center mb-6">
                    <span id="results-count" class="text-sm font-bold text-gray-500">Cargando...</span>
                </div>
                <div id="products-grid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-8"></div>
            </div>
        </div>
    </div>
</section>

<div id="product-modal" class="fixed inset-0 z-[80] hidden" style="display: none;">
    <div class="absolute inset-0 bg-[#143c6c]/80 backdrop-blur-sm transition-opacity" onclick="closeProductModal()"></div>
    <div class="absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 w-full max-w-5xl bg-white rounded-3xl shadow-2xl overflow-hidden flex flex-col md:flex-row h-auto max-h-[90vh]">
        <div class="md:w-1/2 bg-gray-50 p-10 flex items-center justify-center relative border-r border-gray-100">
            <button class="absolute top-4 left-4 text-gray-400 md:hidden bg-white p-2 rounded-full shadow" onclick="closeProductModal()"><i class="fas fa-arrow-left"></i></button>
            <img id="modal-p-img" src="" class="max-h-96 w-auto object-contain shadow-2xl rounded-lg">
        </div>
        <div class="md:w-1/2 p-10 overflow-y-auto flex flex-col relative">
            <button class="absolute top-6 right-6 text-gray-300 hover:text-red-500 hidden md:block" onclick="closeProductModal()"><i class="fas fa-times text-xl"></i></button>
            <div>
                <span id="modal-p-editorial" class="inline-block text-[10px] font-black text-white bg-[#143c6c] px-3 py-1 rounded-full uppercase tracking-widest mb-3">Editorial</span>
                <h2 id="modal-p-title" class="text-3xl md:text-4xl font-black text-gray-900 mb-4 font-outfit leading-tight">Título</h2>
                <div class="flex items-center gap-4 mb-6 text-sm text-gray-500 font-bold uppercase tracking-wide"><span><i class="fas fa-check-circle text-green-500 mr-1"></i> Disponible</span></div>
                <p id="modal-p-desc" class="text-gray-600 text-base font-instrument mb-8 leading-relaxed border-l-4 border-yellow-400 pl-4">...</p>
            </div>
            <div class="mt-auto pt-6 border-t border-gray-100">
                <div class="flex justify-between items-end mb-6"><span class="text-gray-400 text-xs font-bold uppercase tracking-wide">Precio</span><span id="modal-p-price" class="text-4xl font-black text-[#143c6c] font-outfit">$0</span></div>
                <div class="flex gap-4">
                    <div class="flex items-center border-2 border-gray-200 rounded-xl h-14 w-32 justify-between px-2">
                        <button onclick="updateQty(-1)" class="w-8 h-full text-gray-400 font-bold">-</button>
                        <input id="modal-p-qty" type="text" value="1" readonly class="w-8 text-center text-lg font-bold border-none outline-none text-gray-800">
                        <button onclick="updateQty(1)" class="w-8 h-full text-gray-400 font-bold">+</button>
                    </div>
                    <button id="modal-add-btn" class="flex-grow bg-[#fcd34d] text-[#143c6c] font-black text-sm rounded-xl shadow-lg hover:bg-[#fbbf24] transition uppercase flex items-center justify-center gap-2">Añadir al Carrito <i class="fas fa-shopping-cart"></i></button>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    (function() {
        var PRODUCTS = [
            { id: 'B01', title: 'English Path Level 1', editorial: 'Macmillan', price: '$85.000', img: 'https://sbooks.com.co/wp-content/uploads/2023/11/Cosmo-1.jpg', desc: 'Libro de texto integral para el aprendizaje del inglés nivel A1.' },
            { id: 'B02', title: 'El Pan de la Guerra', editorial: 'Castillo', price: '$45.000', img: 'https://sbooks.com.co/wp-content/uploads/2023/01/9789585189332.jpg', desc: 'Una novela conmovedora sobre la supervivencia en tiempos de conflicto.' },
            { id: 'B03', title: 'Global Explorer 2', editorial: 'Macmillan', price: '$92.000', img: 'https://sbooks.com.co/wp-content/uploads/2023/11/Cosmo-2.jpg', desc: 'Explora el mundo a través del inglés con este texto interactivo.' }
        ];

        var currentQty = 1;
        var currentProduct = null;

        function renderStore(filterText = '', editorials = []) {
            var grid = document.getElementById('products-grid');
            if (!grid) return;
            
            grid.innerHTML = '';
            var countLabel = document.getElementById('results-count');

            var filtered = PRODUCTS.filter(function(p) {
                var matchesText = p.title.toLowerCase().includes(filterText.toLowerCase());
                var matchesEdit = editorials.length === 0 || editorials.includes(p.editorial);
                return matchesText && matchesEdit;
            });

            if (countLabel) countLabel.innerText = filtered.length + " productos encontrados";

            if (filtered.length === 0) {
                grid.innerHTML = '<div class="col-span-3 text-center py-20 text-gray-400">Sin resultados</div>';
            } else {
                filtered.forEach(function(p) {
                    var card = document.createElement('div');
                    card.className = 'bg-white rounded-2xl shadow-sm border border-gray-100 overflow-hidden hover:shadow-xl transition-all duration-300 group cursor-pointer animate-scroll-reveal';
                    card.innerHTML = `
                        <div class="h-72 overflow-hidden relative bg-gray-50 p-6 flex items-center justify-center">
                            <img src="${p.img}" class="max-h-full max-w-full object-contain transition duration-500 group-hover:scale-110 drop-shadow-md">
                        </div>
                        <div class="p-6">
                            <span class="text-[10px] text-gray-400 uppercase font-black bg-gray-100 px-2 py-1 rounded">${p.editorial}</span>
                            <h3 class="font-bold text-gray-800 text-lg mb-3 line-clamp-2 leading-tight mt-2">${p.title}</h3>
                            <div class="flex justify-between items-end border-t border-gray-50 pt-4 mt-2">
                                <span class="font-black text-2xl text-[#143c6c] font-outfit">${p.price}</span>
                                <span class="text-xs font-bold text-yellow-500 underline decoration-dotted">Ver Detalle</span>
                            </div>
                        </div>`;
                    card.onclick = function() { openProductModal(p); };
                    grid.appendChild(card);
                });
            }
        }

        window.openProductModal = function(product) {
            currentProduct = product;
            currentQty = 1;
            document.getElementById('modal-p-img').src = product.img;
            document.getElementById('modal-p-title').innerText = product.title;
            document.getElementById('modal-p-editorial').innerText = product.editorial;
            document.getElementById('modal-p-desc').innerText = product.desc;
            document.getElementById('modal-p-price').innerText = product.price;
            document.getElementById('modal-p-qty').value = 1;

            document.getElementById('modal-add-btn').onclick = function() {
                if (window.addToCart) {
                    window.addToCart({ 
                        id: product.id, name: product.title, price: product.price, img: product.img, qty: currentQty 
                    });
                }
                closeProductModal();
            };

            var modal = document.getElementById('product-modal');
            modal.classList.remove('hidden');
            modal.style.display = 'block';
        };

        window.closeProductModal = function() {
            document.getElementById('product-modal').style.display = 'none';
        };

        window.updateQty = function(change) {
            var newQty = currentQty + change;
            if (newQty >= 1) {
                currentQty = newQty;
                document.getElementById('modal-p-qty').value = currentQty;
            }
        };

        window.resetFilters = function() {
            var search = document.getElementById('store-search');
            if (search) search.value = '';
            var checkboxes = document.querySelectorAll('.filter-cb');
            checkboxes.forEach(function(cb) { cb.checked = false; });
            renderStore();
        };

        var searchInput = document.getElementById('store-search');
        if (searchInput) {
            var checkboxes = document.querySelectorAll('.filter-cb');
            function applyFilters() {
                var text = searchInput.value;
                var selectedEditorials = Array.from(checkboxes).filter(function(cb) { return cb.checked; }).map(function(cb) { return cb.value; });
                renderStore(text, selectedEditorials);
            }
            searchInput.addEventListener('keyup', applyFilters);
            checkboxes.forEach(function(cb) { cb.addEventListener('change', applyFilters); });
        }

        renderStore();
    })();
</script>