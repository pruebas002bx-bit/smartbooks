<section class="relative bg-[#143c6c] pt-24 pb-40 md:pt-28 md:pb-48 overflow-hidden text-center animate-scroll-reveal">
    <div class="absolute inset-0 opacity-10" style="background-image: radial-gradient(#ffffff 1px, transparent 1px); background-size: 24px 24px;"></div>
    <div class="absolute top-0 right-0 w-64 h-64 md:w-96 md:h-96 bg-blue-500 rounded-full mix-blend-multiply filter blur-3xl opacity-20 animate-blob"></div>
    <div class="absolute bottom-0 left-0 w-64 h-64 md:w-96 md:h-96 bg-yellow-400 rounded-full mix-blend-multiply filter blur-3xl opacity-20 animate-blob animation-delay-2000"></div>

    <div class="relative z-10 px-4">
        <span class="inline-flex items-center gap-2 py-1.5 px-4 md:px-5 rounded-full bg-white/10 text-yellow-300 text-[10px] md:text-xs font-bold uppercase tracking-widest mb-4 md:mb-6 border border-white/10 backdrop-blur-md shadow-lg">
            <i class="fas fa-school"></i> Zona Escolar Oficial
        </span>
        <h1 class="font-outfit text-3xl md:text-6xl font-black text-white mb-4 md:mb-6 leading-tight tracking-tight">
            Tu Lista Escolar,<br> <span class="text-transparent bg-clip-text bg-gradient-to-r from-yellow-300 to-yellow-500">Lista en un Clic</span>
        </h1>
        <p class="text-blue-100 font-instrument text-base md:text-lg max-w-2xl mx-auto leading-relaxed px-2">
            Hemos digitalizado las listas de útiles de las mejores instituciones. Selecciona tu colegio y grado para acceder al kit oficial aprobado.
        </p>
    </div>
</section>

<section class="relative bg-gray-50 pb-20 md:pb-24 min-h-[800px]">
    <div class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8">
        
        <div class="relative -mt-24 md:-mt-32 z-30 bg-white rounded-2xl md:rounded-3xl shadow-xl md:shadow-2xl border border-gray-100 p-6 md:p-12 animate-scroll-reveal delay-100">
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-8 md:gap-10 items-start relative">
                
                <div class="hidden md:block absolute left-1/2 top-0 bottom-0 w-px bg-gradient-to-b from-transparent via-gray-200 to-transparent"></div>

                <div class="relative z-50">
                    <div class="flex items-center justify-between mb-3 md:mb-4">
                        <label class="text-xs md:text-sm font-bold text-[#143c6c] font-outfit uppercase tracking-wider flex items-center gap-2">
                            <span class="bg-[#143c6c] text-white w-6 h-6 rounded-full flex items-center justify-center text-xs shadow-md">1</span> Institución
                        </label>
                        <span class="bg-blue-50 text-[#143c6c] text-[10px] font-bold px-2 py-0.5 rounded border border-blue-100">REQUERIDO</span>
                    </div>
                    
                    <div id="school-dropdown-container" class="relative group">
                        <button id="school-select-button" class="w-full bg-white border-2 border-gray-200 text-left py-4 px-4 md:py-4 md:px-5 rounded-xl flex items-center justify-between transition-all duration-300 hover:border-[#143c6c] hover:shadow-md focus:outline-none focus:ring-4 focus:ring-blue-50 active:scale-[0.98]">
                            <span class="text-gray-500 font-medium text-base md:text-lg truncate flex items-center gap-2">
                                <i class="fas fa-search text-gray-300"></i> <span class="truncate">Buscar colegio...</span>
                            </span>
                            <div class="bg-gray-100 rounded-lg p-2 text-gray-400 group-hover:bg-[#143c6c] group-hover:text-white transition shrink-0">
                                <i class="fas fa-chevron-down text-xs"></i>
                            </div>
                        </button>

                        <div id="school-dropdown-menu" class="hidden absolute top-full left-0 w-full bg-white border border-gray-100 rounded-xl md:rounded-xl shadow-2xl mt-2 md:mt-3 overflow-hidden transform origin-top transition-all duration-200 z-[60] ring-1 ring-black/5">
                            <div class="p-3 bg-gray-50 border-b border-gray-100">
                                <input type="text" id="school-search-input" placeholder="Filtrar por nombre..." class="w-full bg-white border border-gray-200 rounded-lg py-2 px-4 text-sm focus:outline-none focus:border-[#143c6c] focus:ring-1 focus:ring-[#143c6c]">
                            </div>
                            <div id="school-list" class="max-h-60 overflow-y-auto custom-scrollbar bg-white p-1">
                                </div>
                        </div>
                    </div>
                </div>

                <div class="relative z-40">
                    <div class="flex items-center justify-between mb-3 md:mb-4">
                        <label class="text-xs md:text-sm font-bold text-gray-400 font-outfit uppercase tracking-wider flex items-center gap-2" id="label-grade">
                            <span class="bg-gray-200 text-gray-500 w-6 h-6 rounded-full flex items-center justify-center text-xs transition-colors" id="badge-number-2">2</span> Grado Escolar
                        </label>
                        <span class="bg-gray-100 text-gray-400 text-[10px] font-bold px-2 py-0.5 rounded border border-gray-200 transition-colors" id="badge-status-2">PENDIENTE</span>
                    </div>

                    <div id="course-dropdown-container" class="relative opacity-50 pointer-events-none transition-all duration-300 grayscale">
                        <button id="course-select-button" class="w-full bg-gray-50 border-2 border-gray-200 text-left py-4 px-4 md:py-4 md:px-5 rounded-xl flex items-center justify-between cursor-not-allowed">
                            <span class="text-gray-400 font-medium text-base md:text-lg flex items-center gap-2 truncate">
                                <i class="fas fa-layer-group text-gray-300"></i> <span class="truncate">Primero el colegio</span>
                            </span>
                            <div class="bg-gray-200 rounded-lg p-2 text-gray-400 shrink-0">
                                <i class="fas fa-lock text-xs"></i>
                            </div>
                        </button>

                        <div id="course-dropdown-menu" class="hidden absolute top-full left-0 w-full bg-white border border-gray-100 rounded-xl md:rounded-xl shadow-2xl mt-2 md:mt-3 overflow-hidden z-[60] ring-1 ring-black/5">
                            <div id="course-list" class="max-h-60 overflow-y-auto custom-scrollbar p-1 bg-white">
                                </div>
                        </div>
                    </div>
                </div>

            </div>
        </div>

        <div id="results-area" class="mt-12 md:mt-16 min-h-[300px] relative z-10">
            
            <div id="search-loading" class="hidden flex-col items-center justify-center py-12 animate-pulse">
                <div class="relative">
                    <div class="w-16 h-16 border-4 border-gray-200 border-t-[#143c6c] rounded-full animate-spin mb-4"></div>
                    <div class="absolute inset-0 flex items-center justify-center">
                        <i class="fas fa-book text-[#143c6c] text-xl"></i>
                    </div>
                </div>
                <p class="text-gray-500 font-instrument text-base md:text-lg font-medium">Consultando disponibilidad...</p>
            </div>

            <div id="initial-state" class="text-center py-10 md:py-12 opacity-50 flex flex-col items-center">
                <div class="w-16 h-16 md:w-20 md:h-20 bg-gray-200 rounded-full flex items-center justify-center mb-4 text-gray-400">
                    <i class="fas fa-search-location text-2xl md:text-3xl"></i>
                </div>
                <h3 class="text-lg md:text-xl font-bold text-gray-500 font-outfit mb-2">Esperando selección</h3>
                <p class="text-sm md:text-base text-gray-400 font-instrument max-w-xs md:max-w-md">Completa los pasos anteriores para visualizar el kit oficial.</p>
            </div>

            <div id="package-card" class="hidden bg-white rounded-2xl md:rounded-3xl shadow-xl md:shadow-2xl overflow-hidden border border-gray-100 animate-scroll-reveal transform transition-all max-w-5xl mx-auto ring-1 ring-black/5">
                <div class="flex flex-col md:flex-row h-full">
                    
                    <div class="md:w-5/12 bg-gray-50 p-6 md:p-10 flex flex-col items-center justify-center text-center border-b md:border-b-0 md:border-r border-gray-200 relative overflow-hidden group">
                        <div class="absolute inset-0 bg-[#143c6c] opacity-0 group-hover:opacity-5 transition duration-700"></div>
                        <div class="absolute -top-10 -left-10 w-32 h-32 bg-blue-200 rounded-full mix-blend-multiply filter blur-2xl opacity-50"></div>
                        
                        <div class="relative z-10 w-32 h-32 md:w-44 md:h-44 bg-white rounded-full flex items-center justify-center shadow-lg mb-4 md:mb-6 p-4 border-4 md:border-8 border-white transition transform group-hover:scale-105 duration-500">
                            <img id="card-imagen" src="" alt="Logo Colegio" class="w-full h-full object-contain">
                        </div>
                        
                        <h3 id="card-colegio" class="relative z-10 font-outfit text-xl md:text-2xl font-black text-[#143c6c] mb-1 md:mb-2 leading-tight px-2">Nombre Colegio</h3>
                        <div class="relative z-10 inline-flex items-center gap-2 bg-blue-100 text-[#143c6c] text-[10px] font-bold px-3 py-1 rounded-full uppercase tracking-widest mb-2 md:mb-4">
                            <i class="fas fa-certificate text-yellow-500"></i> Aliado Oficial
                        </div>
                    </div>

                    <div class="md:w-7/12 p-6 md:p-10 flex flex-col justify-between bg-white relative">
                        <div class="absolute top-0 right-0 w-16 h-16 md:w-20 md:h-20 bg-yellow-400 opacity-10 rounded-bl-full"></div>

                        <div>
                            <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center mb-6 md:mb-8 pb-4 md:pb-6 border-b border-gray-100">
                                <div class="mb-2 sm:mb-0">
                                    <p class="text-gray-400 text-[10px] md:text-xs font-bold uppercase tracking-wider mb-1">Kit Seleccionado para</p>
                                    <h4 id="card-curso" class="text-2xl md:text-3xl font-black text-gray-900 font-outfit">Grado</h4>
                                </div>
                                <div class="bg-green-50 text-green-700 px-3 py-1.5 md:px-4 md:py-2 rounded-lg text-[10px] md:text-xs font-bold uppercase tracking-wide flex items-center border border-green-100 shadow-sm">
                                    <div class="w-2 h-2 bg-green-500 rounded-full mr-2 animate-pulse"></div> Disponible
                                </div>
                            </div>

                            <div class="space-y-4 mb-6 md:mb-8">
                                <div class="bg-gray-50 rounded-xl md:rounded-2xl p-4 md:p-5 border border-gray-200 flex items-start gap-4 transition hover:bg-blue-50/50 hover:border-blue-200 group">
                                    <div class="w-10 h-10 md:w-12 md:h-12 bg-white rounded-lg md:rounded-xl flex items-center justify-center text-[#143c6c] text-lg md:text-xl shadow-sm border border-gray-100 shrink-0 group-hover:text-yellow-500 transition-colors">
                                        <i class="fas fa-layer-group"></i>
                                    </div>
                                    <div>
                                        <h5 class="font-bold text-gray-900 font-outfit text-sm md:text-base mb-1" id="card-kit-name">Nombre del Kit</h5>
                                        <p class="text-xs md:text-sm text-gray-500 font-instrument leading-relaxed" id="package-details">
                                            Descripción del contenido...
                                        </p>
                                    </div>
                                </div>
                                
                                <div class="grid grid-cols-3 gap-2 md:gap-3 opacity-80">
                                    <div class="bg-gray-50 rounded-lg p-2 md:p-3 border border-gray-100 flex flex-col items-center justify-center text-center">
                                        <i class="fas fa-check-circle text-green-500 text-lg md:text-xl mb-1"></i>
                                        <span class="text-[10px] md:text-xs font-bold text-gray-400 uppercase">Original</span>
                                    </div>
                                    <div class="bg-gray-50 rounded-lg p-2 md:p-3 border border-gray-100 flex flex-col items-center justify-center text-center">
                                        <i class="fas fa-shield-alt text-[#143c6c] text-lg md:text-xl mb-1"></i>
                                        <span class="text-[10px] md:text-xs font-bold text-gray-400 uppercase">Garantía</span>
                                    </div>
                                    <div class="bg-gray-50 rounded-lg p-2 md:p-3 border border-gray-100 flex flex-col items-center justify-center text-center">
                                        <i class="fas fa-truck text-yellow-500 text-lg md:text-xl mb-1"></i>
                                        <span class="text-[10px] md:text-xs font-bold text-gray-400 uppercase">Envío</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="flex flex-col sm:flex-row items-center justify-between gap-4 pt-2 md:pt-4 mt-auto border-t border-gray-50 md:border-none">
                            <div class="text-center sm:text-left w-full sm:w-auto">
                                <span class="block text-[10px] md:text-xs text-gray-400 uppercase font-bold tracking-wide mb-1">Precio Total</span>
                                <span class="text-xl md:text-2xl font-black text-[#143c6c] font-outfit tracking-tight block">Ver en Carrito</span>
                            </div>
                            
                            <button id="add-kit-btn" class="w-full sm:w-auto bg-[#fcd34d] text-[#143c6c] font-black py-3.5 px-8 md:py-4 md:px-10 rounded-xl shadow-lg shadow-yellow-200/50 hover:bg-[#fbbf24] hover:shadow-xl transition-all transform hover:-translate-y-1 flex items-center justify-center gap-3 text-xs md:text-sm uppercase tracking-wider group">
                                <span>Añadir al Carrito</span>
                                <div class="bg-white/20 rounded-full p-1.5 group-hover:bg-white/40 transition">
                                    <i class="fas fa-shopping-bag text-sm"></i>
                                </div>
                            </button>
                        </div>
                    </div>
                </div>
            </div>

        </div>
    </div>
</section>

<style>
    .custom-scrollbar::-webkit-scrollbar { width: 6px; }
    .custom-scrollbar::-webkit-scrollbar-track { background: transparent; }
    .custom-scrollbar::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 10px; border: 2px solid #fff; }
    .custom-scrollbar::-webkit-scrollbar-thumb:hover { background: #94a3b8; }
    
    .animate-blob { animation: blob 7s infinite; }
    @keyframes blob {
        0% { transform: translate(0px, 0px) scale(1); }
        33% { transform: translate(30px, -50px) scale(1.1); }
        66% { transform: translate(-20px, 20px) scale(0.9); }
        100% { transform: translate(0px, 0px) scale(1); }
    }
</style>

<script>
    (function() {
        // DATOS DE EJEMPLO REALISTAS
        const SCHOOLS_DATA = [
            { 
                id: '001', name: 'Cosmo Schools', city: 'Medellín', img: 'https://sbooks.com.co/wp-content/uploads/2024/11/LOGO-COLEGIO.png', 
                kits: { 
                    'PRIMERO': { id: 'K01', name: 'Kit Cosmo 1° - English Path', price: '$245.000', count: 5 }, 
                    'SEGUNDO': { id: 'K02', name: 'Kit Cosmo 2° - Global', price: '$255.000', count: 6 },
                    'TERCERO': { id: 'K07', name: 'Kit Cosmo 3° - Discovery', price: '$260.000', count: 6 }
                } 
            },
            { 
                id: '002', name: 'Gimnasio San Angelo', city: 'Bogotá', img: 'https://sbooks.com.co/wp-content/uploads/2024/12/3-6-150x150.png', 
                kits: { 
                    'PRIMERO': { id: 'K03', name: 'Kit San Angelo 1°', price: '$180.000', count: 4 }, 
                    'ONCE': { id: 'K04', name: 'Kit San Angelo 11° - Pre-ICFES', price: '$310.000', count: 7 } 
                } 
            },
            { 
                id: '003', name: 'Cafam', city: 'Bogotá', img: 'https://sbooks.com.co/wp-content/uploads/2024/12/1-6.png', 
                kits: { 
                    'TRANSICION': { id: 'K05', name: 'Kit Cafam Transición', price: '$150.000', count: 3 } 
                } 
            },
            { 
                id: '004', name: 'Liceo Parroquial San José', city: 'Bogotá', img: 'https://sbooks.com.co/wp-content/uploads/2024/12/2-6.png', 
                kits: { 
                    'SEXTO': { id: 'K06', name: 'Kit San José 6°', price: '$220.000', count: 5 },
                    'SEPTIMO': { id: 'K08', name: 'Kit San José 7°', price: '$230.000', count: 5 }
                } 
            }
        ];

        const GRADES_MAP = {
            'PREJARDIN': 'Prejardín', 'JARDIN': 'Jardín', 'TRANSICION': 'Transición',
            'PRIMERO': 'Primero (1°)', 'SEGUNDO': 'Segundo (2°)', 'TERCERO': 'Tercero (3°)',
            'CUARTO': 'Cuarto (4°)', 'QUINTO': 'Quinto (5°)', 'SEXTO': 'Sexto (6°)',
            'SEPTIMO': 'Séptimo (7°)', 'OCTAVO': 'Octavo (8°)', 'NOVENO': 'Noveno (9°)',
            'DECIMO': 'Décimo (10°)', 'ONCE': 'Once (11°)'
        };

        // Helpers seguros
        const getEl = (id) => document.getElementById(id);
        const els = {
            schoolBtn: getEl('school-select-button'),
            schoolMenu: getEl('school-dropdown-menu'),
            schoolList: getEl('school-list'),
            schoolSearch: getEl('school-search-input'),
            schoolContainer: getEl('school-dropdown-container'),
            
            courseBtn: getEl('course-select-button'),
            courseMenu: getEl('course-dropdown-menu'),
            courseList: getEl('course-list'),
            courseContainer: getEl('course-dropdown-container'),
            
            labelGrade: getEl('label-grade'),
            badgeGradeNumber: getEl('badge-number-2'),
            badgeGradeStatus: getEl('badge-status-2'),
            
            card: getEl('package-card'),
            loading: getEl('search-loading'),
            initialState: getEl('initial-state'),
            addBtn: getEl('add-kit-btn'),
            
            cardColegio: getEl('card-colegio'),
            cardCity: getEl('card-city'),
            cardCurso: getEl('card-curso'),
            cardImagen: getEl('card-imagen'),
            cardKitName: getEl('card-kit-name'),
            // Eliminado cardPrice de la vista principal, se maneja internamente
            packageDetails: getEl('package-details')
        };

        let currentSchool = null;

        // 1. Renderizar Escuelas
        function renderSchools(filter = '') {
            if (!els.schoolList) return;
            els.schoolList.innerHTML = '';
            const filtered = SCHOOLS_DATA.filter(s => s.name.toLowerCase().includes(filter.toLowerCase()));
            
            if(filtered.length === 0) { 
                els.schoolList.innerHTML = '<div class="p-6 text-gray-400 text-center text-sm font-instrument">No encontramos coincidencias.</div>'; 
                return; 
            }
            
            filtered.forEach(school => {
                const div = document.createElement('div');
                div.className = 'p-3 md:p-4 hover:bg-blue-50 cursor-pointer border-b border-gray-50 last:border-0 flex justify-between items-center group transition-colors duration-200';
                div.innerHTML = `
                    <div class="flex items-center gap-3 overflow-hidden">
                        <div class="w-8 h-8 md:w-10 md:h-10 rounded-lg bg-gray-50 border border-gray-200 p-1 flex items-center justify-center shrink-0">
                            <img src="${school.img}" class="w-full h-full object-contain">
                        </div>
                        <span class="font-bold text-gray-700 group-hover:text-[#143c6c] font-outfit text-sm md:text-base truncate">${school.name}</span>
                    </div>
                    <span class="text-[10px] bg-gray-100 text-gray-500 px-2 py-1 rounded-full font-bold uppercase group-hover:bg-[#143c6c] group-hover:text-white transition tracking-wide shrink-0 ml-2">${school.city}</span>
                `;
                div.onclick = (e) => { e.stopPropagation(); selectSchool(school); };
                els.schoolList.appendChild(div);
            });
        }

        // 2. Seleccionar Escuela
        function selectSchool(school) {
            currentSchool = school;
            
            els.schoolBtn.innerHTML = `
                <div class="flex items-center gap-2 md:gap-3 overflow-hidden">
                    <img src="${school.img}" class="w-6 h-6 object-contain shrink-0">
                    <span class="font-bold text-[#143c6c] text-base md:text-lg truncate">${school.name}</span>
                </div>
                <div class="bg-green-100 text-green-600 rounded-full p-1 shadow-sm shrink-0"><i class="fas fa-check text-xs"></i></div>
            `;
            els.schoolBtn.className = "w-full bg-blue-50/50 border-2 border-[#143c6c] text-left py-4 px-4 md:py-5 md:px-6 rounded-xl md:rounded-2xl flex items-center justify-between shadow-md transition-all relative z-20";
            els.schoolMenu.classList.add('hidden');

            els.courseContainer.classList.remove('opacity-50', 'pointer-events-none', 'grayscale');
            els.courseBtn.innerHTML = `
                <span class="text-gray-600 font-bold text-base md:text-lg flex items-center gap-2 md:gap-3 truncate">
                    <i class="fas fa-layer-group text-[#143c6c]"></i> <span class="truncate">Selecciona el Grado</span>
                </span>
                <div class="bg-[#143c6c] rounded-lg p-2 text-white shadow-lg hover:scale-110 transition-transform shrink-0">
                    <i class="fas fa-chevron-down text-xs"></i>
                </div>
            `;
            els.courseBtn.className = "w-full bg-white border-2 border-gray-200 text-left py-4 px-4 md:py-5 md:px-6 rounded-xl md:rounded-2xl flex items-center justify-between hover:border-[#143c6c] hover:shadow-lg transition-all duration-300 cursor-pointer group relative z-20";
            
            els.labelGrade.classList.remove('text-gray-400');
            els.labelGrade.classList.add('text-[#143c6c]');
            if(els.badgeGradeNumber) {
                els.badgeGradeNumber.classList.remove('bg-gray-200', 'text-gray-500');
                els.badgeGradeNumber.classList.add('bg-[#143c6c]', 'text-white', 'shadow-md');
            }
            if(els.badgeGradeStatus) {
                els.badgeGradeStatus.textContent = "Seleccionar";
                els.badgeGradeStatus.className = "bg-yellow-100 text-yellow-700 text-[10px] font-bold px-2 py-1 rounded border border-yellow-200 uppercase tracking-wide animate-pulse";
            }

            els.card.classList.add('hidden');
            els.initialState.classList.remove('hidden');
            renderCourses();
        }

        // 3. Renderizar Cursos
        function renderCourses() {
            if (!els.courseList) return;
            els.courseList.innerHTML = '';
            
            const grades = Object.keys(currentSchool.kits);

            if (grades.length === 0) {
                els.courseList.innerHTML = '<div class="p-6 text-gray-400 text-center text-sm font-instrument">No hay kits disponibles.</div>';
                return;
            }

            grades.forEach(gradeKey => {
                const el = document.createElement('div');
                el.className = 'p-4 hover:bg-blue-50 cursor-pointer border-b border-gray-50 last:border-0 font-bold text-gray-600 hover:text-[#143c6c] transition font-outfit flex items-center gap-3 group';
                el.innerHTML = `
                    <div class="w-8 h-8 rounded-lg bg-gray-100 flex items-center justify-center group-hover:bg-[#143c6c] group-hover:text-white transition-colors shrink-0">
                        <i class="fas fa-graduation-cap text-sm"></i>
                    </div>
                    ${GRADES_MAP[gradeKey] || gradeKey}
                `;
                el.onclick = (e) => { e.stopPropagation(); selectCourse(gradeKey); };
                els.courseList.appendChild(el);
            });
        }

        // 4. Seleccionar Curso
        function selectCourse(gradeKey) {
            const gradeName = GRADES_MAP[gradeKey] || gradeKey;
            
            els.courseBtn.innerHTML = `
                <span class="font-bold text-[#143c6c] text-base md:text-lg flex items-center gap-2 md:gap-3 truncate">
                    <i class="fas fa-graduation-cap"></i> ${gradeName}
                </span>
                <div class="bg-green-100 text-green-600 rounded-full p-1 shadow-sm shrink-0"><i class="fas fa-check text-xs"></i></div>
            `;
            els.courseBtn.className = "w-full bg-blue-50/50 border-2 border-[#143c6c] text-left py-4 px-4 md:py-5 md:px-6 rounded-xl md:rounded-2xl flex items-center justify-between shadow-md transition-all relative z-20";
            els.courseMenu.classList.add('hidden');
            
            if(els.badgeGradeStatus) {
                els.badgeGradeStatus.textContent = "Completado";
                els.badgeGradeStatus.className = "bg-green-100 text-green-700 text-[10px] font-bold px-2 py-1 rounded border border-green-200 uppercase tracking-wide";
            }

            els.initialState.classList.add('hidden');
            els.card.classList.add('hidden');
            els.loading.classList.remove('hidden');
            els.loading.classList.add('flex');

            setTimeout(() => {
                els.loading.classList.add('hidden');
                els.loading.classList.remove('flex');
                const kit = currentSchool.kits[gradeKey];
                showCard(gradeName, kit);
            }, 800);
        }

        // 5. Mostrar Tarjeta
        function showCard(gradeName, kit) {
            if (els.cardColegio) els.cardColegio.textContent = currentSchool.name;
            // if (els.cardCity) els.cardCity.textContent = currentSchool.city; // Eliminado
            if (els.cardCurso) els.cardCurso.textContent = gradeName;
            if (els.cardImagen) els.cardImagen.src = currentSchool.img;
            
            if (els.cardKitName) els.cardKitName.textContent = kit.name || 'Kit Escolar Oficial';
            if (els.packageDetails) els.packageDetails.textContent = `Contiene ${kit.count} libros y materiales requeridos.`;
            
            if (els.addBtn) {
                els.addBtn.onclick = () => {
                    if (window.addToCart) {
                        window.addToCart({
                            id: kit.id || Date.now(),
                            name: `${kit.name} - ${currentSchool.name}`,
                            price: kit.price,
                            img: currentSchool.img,
                            qty: 1
                        });
                    } else {
                        console.error("Función addToCart global no encontrada.");
                    }
                };
            }

            els.card.classList.remove('hidden');
            
            const yOffset = -80; 
            const y = els.card.getBoundingClientRect().top + window.pageYOffset + yOffset;
            window.scrollTo({top: y, behavior: 'smooth'});
        }

        // Listeners
        if (els.schoolBtn) {
            els.schoolBtn.onclick = (e) => { 
                e.stopPropagation(); 
                els.schoolMenu.classList.toggle('hidden'); 
                els.courseMenu.classList.add('hidden'); 
                if(!els.schoolMenu.classList.contains('hidden')) setTimeout(() => els.schoolSearch.focus(), 100);
            };

            els.courseBtn.onclick = (e) => { 
                e.stopPropagation(); 
                if (!els.courseBtn.classList.contains('cursor-not-allowed')) {
                    els.courseMenu.classList.toggle('hidden'); 
                    els.schoolMenu.classList.add('hidden'); 
                }
            };
            
            els.schoolSearch.onclick = (e) => e.stopPropagation();
            els.schoolSearch.onkeyup = (e) => renderSchools(e.target.value);

            document.addEventListener('click', () => { 
                if(els.schoolMenu) els.schoolMenu.classList.add('hidden'); 
                if(els.courseMenu) els.courseMenu.classList.add('hidden'); 
            });
            
            renderSchools();
        }
    })();
</script>